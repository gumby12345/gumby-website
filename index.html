const imageElement = document.getElementById("image1");
const btnA = document.getElementById("btnA");
const btnB = document.getElementById("btnB");
const galleryA = document.getElementById("galleryA");
const galleryB = document.getElementById("galleryB");

const clickSound = new Audio("audio/click.mp3");

const images = [
  "images/GUMBYWEBFIXED1.png", 
  "images/GUMBYWEBFIXED2.png", 
  "images/GUMBYLOGO3.png",
  "images/GUMBYLOGO4.png", 
  "images/GUMBYLOGO2-.png", // Check if this image exists
  "images/GUMBYLOGO5.png", 
  "images/GUMBYLOGO6.png", 
  "images/GUMBYLOGO7.png", 
  "images/GUMBYLOGO8.png",
  "images/GUMBYLOGO9.png", 
  "images/GUMBYLOGO10.png", 
  "images/GUMBYLOGO11.png",
  "images/GUMBYLOGO12.png", 
  "images/GUMBYLOGO13.png", 
  "images/GUMBYLOGO14.png",
  "images/GUMBYLOGO15.png", 
  "images/GUMBYLOGO16.png", 
  "images/GUMBYLOGO17.png"
];

const sounds = Array.from({ length: 120 }, (_, i) => `audio/sound${i + 1}.mp3`);

let shownImages = [];
let shownSounds = [];

function getRandomItem(items, shownItems) {
  const remaining = items.filter(item => !shownItems.includes(item));
  if (remaining.length === 0) shownItems.length = 0;
  const selected = remaining[Math.floor(Math.random() * remaining.length)];
  shownItems.push(selected);
  return selected;
}

// Toggle buttons
btnA.addEventListener("click", () => {
  galleryA.classList.remove("hidden");
  galleryB.classList.add("hidden");
  btnA.classList.add("active");
  btnB.classList.remove("active");
  clickSound.play();
});

btnB.addEventListener("click", () => {
  galleryB.classList.remove("hidden");
  galleryA.classList.add("hidden");
  btnB.classList.add("active");
  btnA.classList.remove("active");
  clickSound.play();
});

// Main image click
imageElement.addEventListener("click", () => {
  const newImage = getRandomItem(images, shownImages);
  imageElement.src = newImage;

  // Add an error handler in case the image fails to load
  imageElement.onerror = function() {
    console.log(`Error loading image: ${newImage}. Falling back to default image.`);
    imageElement.src = "images/GUMBYWEBFIXED1.png";  // Set fallback image
  };

  new Audio(getRandomItem(sounds, shownSounds)).play();
  stopJiggle();
});

// Jiggle logic
let jiggleTimer;
let growTimeout;

function startJiggle() {
  imageElement.classList.add("jiggling");
  imageElement.style.transform = "scale(1.05)";
}

function stopJiggle() {
  imageElement.classList.remove("jiggling");
  imageElement.style.transform = "scale(1)";
  clearTimeout(growTimeout);
  resetInactivityTimer();
}

function resetInactivityTimer() {
  clearTimeout(jiggleTimer);
  jiggleTimer = setTimeout(() => {
    startJiggle();
    growTimeout = setTimeout(() => {
      imageElement.style.transform = "scale(1.25)";
    }, 30000);
  }, 15000);
}

// Start the timer on load
resetInactivityTimer();
document.body.addEventListener("click", resetInactivityTimer);
